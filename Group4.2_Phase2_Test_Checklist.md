# Group 4.2 Phase 2: Pre-Call Briefs Test Checklist

## Test 4: Pre-Call Briefs - Premium User with Calendar Event âœ… COMPLETE

### Prerequisites
- [x] Logged in as Premium user (`mcddsl@icloud.com`) âœ…
- [x] Calendar is connected (Google or Outlook) âœ…
- [x] At least one person pin exists (e.g., "Peter", "Paul") âœ…
- [x] Calendar event created in the next 24 hours with:
  - [x] Title containing "call", "meeting", "zoom", "Google Meet", "Teams", or similar keyword âœ…
  - [x] OR event has video conferencing link (Google Meet, Zoom, Teams) âœ…
  - [x] Event should match a person pin name (for best results) âœ…

### Test Steps

1. **Create Calendar Event:**
   - [x] In Google Calendar or Outlook, create an event for tomorrow (within 24 hours) âœ…
   - [x] Title examples:
     - "Call with Peter" âœ…
     - "Zoom with Paul" âœ…
     - "Google Meet: Project Review" âœ…
     - "Teams sync with John" âœ…
   - [x] If person pin exists, include their name in the title âœ…
   - [x] Add video conferencing if possible (Google Meet, Zoom, Teams) âœ…

2. **Check Daily Plan Page:**
   - [x] Navigate to `/app/plan` âœ…
   - [x] Should see Pre-Call Brief card(s) if calls detected âœ…
   - [x] Card should show:
     - [x] Event title âœ…
     - [x] Time (e.g., "2:00 PM") âœ…
     - [x] Person name (if matched to pin) âœ…
     - [x] Video conference icon (ğŸ“¹) or phone icon (ğŸ“) âœ…
     - [x] Expandable/collapsible content with Show more/Show less âœ…

3. **View Full Brief:**
   - [x] Click "Show more" button âœ…
   - [x] Content expands with scrollable view âœ…
   - [x] Brief should include:
     - [x] Person name (if matched) âœ…
     - [x] Last interaction date (or "No previous interactions") âœ…
     - [x] Follow-up history (Total actions, Replies received) âœ…
     - [x] Suggested talking points âœ…
     - [x] User notes (if available from pin or actions) âœ…

### Expected Results
- âœ… Pre-call brief card appears on daily plan page âœ…
- âœ… Brief content is relevant and helpful âœ…
- âœ… Card displays correctly with fixed compact/expanded states âœ…
- âœ… Person pin matching works (if applicable) âœ…
- âœ… Video conferencing detection works (Google Meet, Zoom, Teams) âœ…

### API Endpoint to Verify
```
GET /api/pre-call-briefs
```
**Expected:** Returns 200 with briefs array

---

## Test 5: Pre-Call Briefs - Standard User Upgrade Prompt âœ… COMPLETE

### Prerequisites
- [x] Logged in as Standard user (different account) âœ…
- [x] Calendar is connected âœ…
- [x] Calendar event with "call" keyword exists âœ…

### Test Steps
1. **Check Daily Plan Page:**
   - [x] Navigate to `/app/plan` âœ…
   - [x] Should see pre-call brief cards with upgrade prompts âœ…
   - [x] Cards show teaser with "Upgrade to Premium to view" button âœ…
   - [x] Clicking upgrade button opens Stripe customer portal âœ…

### Expected Results
- âœ… Standard users see brief cards with upgrade prompts âœ…
- âœ… No errors (graceful handling) âœ…
- âœ… Upgrade button routes to Stripe portal âœ…

### API Endpoint to Verify
```
GET /api/pre-call-briefs
```
**Expected:** Returns 402 with `UPGRADE_REQUIRED`

---

## Test 6: Pre-Call Briefs - No Calendar Connected âœ… COMPLETE

### Prerequisites
- [x] Logged in as Premium user âœ…
- [x] Calendar is NOT connected âœ…
- [x] Navigate to `/app/plan` âœ…

### Test Steps
1. **Check API Response:**
   - [x] API should return success with empty briefs array âœ…
   - [x] Message: "Connect your calendar to get pre-call briefs" (if displayed) âœ…

### Expected Results
- âœ… No errors âœ…
- âœ… Helpful message (if displayed) âœ…
- âœ… Feature doesn't break without calendar âœ…

---

## Test 7: Pre-Call Briefs - Person Pin Matching âœ… COMPLETE

### Prerequisites
- [x] Logged in as Premium user âœ…
- [x] Person pin exists (e.g., "Peter") âœ…
- [x] Calendar event titled "Call with Peter" (or similar) âœ…
- [x] Event is in next 24 hours âœ…
- [x] Action exists for that person (optional, for history) âœ…

### Test Steps
1. **Check Brief:**
   - [x] Brief should show person name âœ…
   - [x] Brief should include action history for that person (if actions exist) âœ…
   - [x] Brief should reference previous interactions âœ…
   - [x] Brief should show notes from pin or actions âœ…

### Expected Results
- âœ… Person pin matched correctly âœ…
- âœ… Brief includes relevant history âœ…
- âœ… Brief is personalized to that contact âœ…

---

## Quick Verification Commands

### Check calendar connection:
```sql
-- Check if user has calendar connected
SELECT 
  u.email,
  u.calendar_connected,
  cc.provider,
  cc.status
FROM users u
LEFT JOIN calendar_connections cc ON cc.user_id = u.id
WHERE u.email = 'mcddsl@icloud.com';
```

### Check person pins:
```sql
-- List person pins for user
SELECT id, name, status, notes
FROM person_pins
WHERE user_id = (
  SELECT id FROM users WHERE email = 'mcddsl@icloud.com'
)
AND status = 'ACTIVE';
```

### Check actions for a person:
```sql
-- Check actions for a specific person (replace 'Peter' with actual name)
SELECT 
  a.action_type,
  a.state,
  a.description,
  a.notes,
  a.created_at,
  a.completed_at
FROM actions a
JOIN person_pins pp ON pp.id = a.person_id
WHERE pp.name ILIKE '%Peter%'
  AND a.user_id = (SELECT id FROM users WHERE email = 'mcddsl@icloud.com')
ORDER BY a.created_at DESC;
```

### Test API endpoint directly:
```bash
# As Premium user (with auth cookie)
curl -X GET "http://localhost:3000/api/pre-call-briefs" \
  -H "Cookie: your-auth-cookie"

# Should return briefs array or empty array
```

---

## Event Naming Tips

For best results, name calendar events with:
- **Keywords:** "call", "zoom", "Google Meet", "Teams", "meeting", "sync"
- **Person name:** Include the person's name if you have them pinned
- **Examples:**
  - âœ… "Call with Peter"
  - âœ… "Zoom with Paul"
  - âœ… "Google Meet: Project Review"
  - âœ… "Teams sync with John"
  - âŒ "Coffee chat" (no keyword)
  - âŒ "Lunch" (no keyword)

**Note:** The system now automatically detects video conferencing from calendar event fields (Google Meet links, Zoom links, Teams links), so even if the title doesn't have keywords, it will still be detected if video conferencing is enabled on the event.

